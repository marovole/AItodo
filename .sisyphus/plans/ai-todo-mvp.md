# AI Todo 深度调研助手 — 完整方案

> 版本: v1.0
> 日期: 2026-01-11
> 状态: 需求确认完成，待开发

---

## 一、产品定位

### 核心理念

> **不是"记住要做什么"，而是"搞清楚这件事到底是什么"**

传统 Todo 假设用户已经知道任务内容，只需追踪完成状态。
而本产品的核心洞察是：**很多 Todo 本身需要调研才能变成可执行的任务。**

### 产品定义

一个**本地桌面应用**，将 Todo 管理与 AI 深度调研能力结合：
- 用户创建一个待调研的问题/链接/想法
- AI 自动启动深度调研（利用用户已订阅的 ChatGPT/Perplexity/Gemini）
- 调研完成后通知用户，结果存入 Todo 详情
- 用户审阅后决定下一步行动

### 目标用户

- 信息工作者、研究者、投资人
- 需要频繁核实信息、追踪动态的人
- 已订阅多个 AI 服务，希望高效利用的人

### 核心差异化

| 维度 | 传统 Todo | AI Todo 深度调研助手 |
|:-----|:----------|:--------------------|
| **任务定义** | 用户已知 | 需要调研才能明确 |
| **AI 角色** | 无/辅助输入 | 主动调研、事实核查 |
| **输出** | 完成状态 | 调研报告 + 决策建议 |
| **成本** | 无 | 复用用户已有订阅，零额外成本 |

---

## 二、核心功能

### Phase 1: 单服务 MVP（3-4周）

| 功能模块 | 详情 |
|:---------|:-----|
| **Todo 基础** | 创建/编辑/删除/状态管理 |
| **状态看板** | 待调研 → 调研中 → 待审阅 → 已归档 |
| **ChatGPT 集成** | 内嵌 WebView，复用登录会话 |
| **Deep Research 自动化** | 注入 Prompt → 触发调研 → 提取结果 |
| **结果展示** | Markdown 渲染 + 实时进度 |
| **本地存储** | SQLite 持久化 |
| **系统通知** | 调研完成时提醒 |

### Phase 2: 多服务扩展（+2-3周）

- Perplexity 集成
- Gemini 集成
- 三源并行调研
- 结果合并/对比视图

### Phase 3: 体验增强（+2周）

- 浏览器扩展（一键创建 Todo）
- 剪贴板监听
- 调研报告导出（PDF/Markdown）
- 历史搜索

---

## 三、技术选型

| 层级 | 选择 | 理由 |
|:-----|:-----|:-----|
| **桌面框架** | Tauri 2.0 | 轻量(10MB)、多WebView原生支持 |
| **基础项目** | Fork [lencx/ChatGPT](https://github.com/lencx/ChatGPT) | 50k stars、自动化代码可复用 |
| **前端** | React + TypeScript | lencx 已有基础 |
| **UI风格** | 类微软 Todo | 简洁、左右分栏、右侧滑入详情 |
| **本地数据库** | SQLite | 轻量、无需服务器 |
| **自动化方式** | JS 注入 + IPC | lencx 已验证可行 |

### 技术调研结论

| 服务 | 官方API | 浏览器自动化 | 最终方案 |
|:-----|:--------|:------------|:---------|
| **ChatGPT** | ✅ 有但贵 | ✅ 可行 | 内嵌WebView + 登录复用 |
| **Perplexity** | ✅ 有$5免费额度 | ✅ 可行 | 内嵌WebView + 登录复用 |
| **Gemini** | ✅ 有但另付费 | ⚠️ Bot检测 | 内嵌WebView + 登录复用 |

---

## 四、系统架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                        AI Todo 桌面应用                              │
│                          (Tauri 2.0)                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────┬───────────────────────────┬──────────────────────┐│
│  │   侧边栏     │        任务列表            │      详情面板        ││
│  │  (TodoNav)  │      (TodoList)           │   (TodoDetail)       ││
│  │             │                           │                      ││
│  │  📥 待调研   │  ┌─────────────────────┐  │  ┌────────────────┐  ││
│  │  🔍 调研中   │  │ ☐ 调查XX公司    🔄  │  │  │ 调研结果       │  ││
│  │  📋 待审阅   │  │ ☐ 核实YY新闻    ⏳  │  │  │ (Markdown)     │  ││
│  │  ✅ 已完成   │  └─────────────────────┘  │  │                │  ││
│  │             │                           │  │ [👁️ 查看实时]   │  ││
│  │  ⚙️ 设置    │  [＋ 新建调研任务]         │  └────────────────┘  ││
│  └─────────────┴───────────────────────────┴──────────────────────┘│
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│                     内嵌 WebView 层（默认隐藏）                       │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │  ChatGPT WebView (持久会话)                                      ││
│  │  ├─ 自动注入 deep_research.js                                   ││
│  │  ├─ 监听 DOM 变化 (MutationObserver)                            ││
│  │  └─ IPC 回传结果 → Rust → React UI                              ││
│  └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│                          Rust 核心层                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │
│  │   cmd.rs     │  │   todo.rs    │  │  setup.rs    │              │
│  │  IPC命令     │  │  Todo CRUD   │  │  窗口管理     │              │
│  │  start_research│ │  SQLite操作  │  │  WebView创建  │              │
│  └──────────────┘  └──────────────┘  └──────────────┘              │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│                        SQLite 本地存储                               │
│  todos | research_results | settings                                │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 五、数据模型

```sql
-- Todo 表
CREATE TABLE todos (
    id TEXT PRIMARY KEY,
    title TEXT NOT NULL,
    description TEXT,
    url TEXT,                        -- 可选链接
    status TEXT DEFAULT 'pending',   -- pending/researching/review/done/archived
    created_at DATETIME,
    updated_at DATETIME
);

-- 调研结果表
CREATE TABLE research_results (
    id TEXT PRIMARY KEY,
    todo_id TEXT REFERENCES todos(id),
    source TEXT,                     -- chatgpt/perplexity/gemini
    content TEXT,                    -- Markdown 内容
    raw_html TEXT,                   -- 原始 HTML（备份）
    started_at DATETIME,
    completed_at DATETIME,
    duration_seconds INTEGER
);

-- 设置表
CREATE TABLE settings (
    key TEXT PRIMARY KEY,
    value TEXT
);
```

---

## 六、自动化流程

### Deep Research 触发流程

```
用户点击 [开始调研]
        │
        ▼
┌─────────────────────────────────────────────────────────────┐
│  React: TodoDetail.tsx                                      │
│  invoke('start_research', { todoId, prompt })               │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│  Rust: cmd.rs                                               │
│  1. 更新 todo.status = 'researching'                        │
│  2. chatgpt_webview.eval("DeepResearch.start(prompt)")      │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│  ChatGPT WebView: deep_research.js                          │
│  1. 找到输入框，注入 prompt                                   │
│  2. 找到 Deep Research 按钮，点击                            │
│  3. MutationObserver 监控结果区域                            │
│  4. 检测到完成 → 提取内容                                     │
│  5. window.__TAURI__.emit('research_complete', { content }) │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│  Rust: 监听 'research_complete' 事件                         │
│  1. 存入 research_results 表                                 │
│  2. 更新 todo.status = 'review'                             │
│  3. 发送系统通知                                             │
│  4. 通知前端刷新 UI                                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 七、文件结构（Fork 后修改）

```
ChatGPT/  (fork from lencx/ChatGPT)
│
├── src-tauri/
│   ├── src/
│   │   ├── main.rs
│   │   └── core/
│   │       ├── setup.rs          # 修改：添加 Todo UI WebView
│   │       ├── cmd.rs            # 修改：添加 todo/research 命令
│   │       ├── conf.rs
│   │       └── todo.rs           # 🆕 Todo 数据管理 (SQLite)
│   │
│   ├── scripts/
│   │   ├── ask.js                # 原有
│   │   └── deep_research.js      # 🆕 Deep Research 自动化
│   │
│   └── Cargo.toml                # 修改：添加 rusqlite 依赖
│
├── src/
│   ├── App.tsx                   # 修改：添加路由
│   ├── components/               # 🆕 通用组件
│   │   ├── Button.tsx
│   │   ├── Input.tsx
│   │   └── Modal.tsx
│   │
│   └── view/
│       ├── Ask.tsx               # 原有
│       ├── TodoApp.tsx           # 🆕 主应用容器
│       ├── TodoSidebar.tsx       # 🆕 左侧导航
│       ├── TodoList.tsx          # 🆕 任务列表
│       ├── TodoDetail.tsx        # 🆕 右侧详情面板
│       ├── TodoCreate.tsx        # 🆕 新建任务
│       ├── ResearchProgress.tsx  # 🆕 调研进度
│       └── Settings.tsx          # 修改：添加 AI 服务设置
│
├── src/styles/
│   └── todo.css                  # 🆕 Todo 样式（类微软风格）
│
└── package.json                  # 修改：添加依赖
```

---

## 八、UI/UX 设计规范

### 设计原则（参考微软 Todo）

| 设计原则 | 应用方式 |
|:---------|:---------|
| **专注减噪** | 控件默认隐藏，hover 时显示 |
| **三栏布局** | 侧边栏 \| 任务列表 \| 详情面板 |
| **Fluent 2 风格** | 柔和阴影、圆角(4-8px)、半透明 |
| **快速输入** | 底部/顶部常驻输入栏，带 `+` 图标 |

### 布局规范

```
┌──────────────────────────────────────────────────────────────────┐
│                        AI Todo 布局                              │
├────────────┬─────────────────────────────┬───────────────────────┤
│            │                             │                       │
│  侧边栏     │         任务列表            │      详情面板          │
│  (200px)   │        (flex: 1)            │      (360px)          │
│  可折叠     │                             │     右侧滑入          │
│            │                             │                       │
│ ┌────────┐ │  ┌───────────────────────┐  │  ┌─────────────────┐  │
│ │📥 待调研│ │  │ ○ 任务标题        ⭐  │  │  │ 任务标题        │  │
│ │🔍 调研中│ │  │   副标题/链接         │  │  │ ─────────────── │  │
│ │📋 待审阅│ │  ├───────────────────────┤  │  │ 状态: 🔄 调研中  │  │
│ │✅ 已完成│ │  │ ○ 任务标题        🔄  │  │  │                 │  │
│ │────────│ │  │   调研中...           │  │  │ 📊 调研结果      │  │
│ │⚙️ 设置 │ │  └───────────────────────┘  │  │ (Markdown)      │  │
│ └────────┘ │                             │  │                 │  │
│            │  ┌───────────────────────┐  │  │ [查看实时画面]   │  │
│            │  │ ＋ 新建调研任务        │  │  └─────────────────┘  │
│            │  └───────────────────────┘  │                       │
│            │                             │                       │
└────────────┴─────────────────────────────┴───────────────────────┘
```

### 组件规范

| 组件 | 样式 |
|:-----|:-----|
| **任务卡片** | 无边框，分隔线，padding: 12-16px |
| **复选框** | 圆形(50%)，2px边框，hover显示勾 |
| **输入栏** | 透明背景，focus时显示边框 |
| **详情面板** | 右侧滑入，200-400ms ease-out |
| **圆角** | 4-8px 统一 |

### 状态视觉

| 状态 | 视觉表现 |
|:-----|:---------|
| **待调研** | 空心圆 ○ |
| **调研中** | 旋转动画 🔄 + 进度文字 |
| **待审阅** | 实心蓝点 ● |
| **已完成** | 删除线 + 透明度 0.6 |

### 动效规范

| 交互 | 动效 |
|:-----|:-----|
| **详情面板滑入** | `translateX(100%) → 0`, 300ms, ease-out |
| **完成任务** | 勾画动画 + 渐隐移动到已完成 |
| **新建任务** | 从输入栏位置向上滑入列表 |

### 设计资源

- **图标**: [Fluent UI System Icons](https://github.com/microsoft/fluentui-system-icons)
- **Figma 参考**: [Microsoft To Do Customized](https://www.figma.com/community/file/1086534618953295138)
- **设计系统**: [Fluent 2 Web UI Kit](https://aka.ms/Fluent2Toolkits/Web/Figma)

---

## 九、开发计划

### Phase 1: MVP（3-4周）

| 周次 | 任务 | 产出 |
|:-----|:-----|:-----|
| **Week 1** | 项目搭建 | Fork 项目、调整结构、SQLite 集成 |
| **Week 2** | Todo 核心 | CRUD、状态管理、列表/详情 UI |
| **Week 3** | 自动化集成 | deep_research.js、IPC 通信、结果提取 |
| **Week 4** | 完善体验 | 系统通知、错误处理、UI 打磨 |

### 里程碑

- **M1 (Week 2)**: 可以创建/管理 Todo，无 AI 功能
- **M2 (Week 3)**: 可以触发 ChatGPT Deep Research，手动复制结果
- **M3 (Week 4)**: 完整闭环——自动调研、自动提取、自动通知

---

## 十、风险与应对

| 风险 | 可能性 | 影响 | 应对策略 |
|:-----|:------|:-----|:---------|
| ChatGPT UI 变化导致自动化失效 | 中 | 高 | 使用稳定选择器、定期更新脚本 |
| Deep Research 响应时间过长 | 高 | 中 | 明确进度提示、支持取消 |
| 登录状态失效 | 低 | 中 | 检测登录状态、引导重新登录 |
| Tauri 2.0 兼容性问题 | 低 | 中 | 跟踪 lencx 上游更新 |

---

## 十一、成功指标

| 指标 | MVP 目标 |
|:-----|:---------|
| 调研成功率 | > 90% 的 Todo 能成功完成调研 |
| 用户等待体验 | 进度提示清晰，不觉得"卡住了" |
| 结果质量 | Markdown 正确渲染，引用链接可点击 |
| 启动时间 | < 3 秒冷启动 |

---

## 十二、下一步行动

1. **Fork lencx/ChatGPT** → 创建新仓库 `AItodo`
2. **搭建开发环境** → Rust + Node + Tauri CLI
3. **创建分支** → `feature/todo-mvp`
4. **开始 Week 1 任务** → 项目结构调整 + SQLite 集成

---

## 十三、竞品与参考调研总结

### 调研的产品/模式

| 产品/模式 | 核心价值 | 借鉴点 |
|:----------|:---------|:-------|
| **Conductor 模式** | Agent 编排、任务分解 | 多 Agent 协作架构 |
| **Vibekanban** | 并行执行、人类审批 | 看板 UI、ExecPlan 流程 |
| **lencx/ChatGPT** | Tauri + ChatGPT 自动化 | 代码直接复用 |
| **ChatHub** | 多 AI 服务聚合 | API 拦截模式 |
| **微软 Todo** | 简洁设计 | UI/UX 规范 |

### AI 调研架构模式

| 模式 | 核心逻辑 | 适用场景 |
|:-----|:---------|:---------|
| **递归树** | 广度搜索 → 递归深入子问题 | 全面深度报告 |
| **验证链** | 调研 → 事实核查 → 共识 → 输出 | 高准确性要求 |
| **智能体循环** | 搜索 → 合成 → 发现缺口 → 再搜索 | 开放式探索 |
| **主管模式** | 主 Agent 分发子任务给专家 Agent | 多面向复杂主题 |

---

## 附录：决策记录

| 决策项 | 选项 | 最终选择 | 理由 |
|:-------|:-----|:---------|:-----|
| 技术框架 | Electron vs Tauri | **Tauri 2.0** | 轻量 + lencx 可复用 |
| 基础项目 | 从头开发 vs Fork | **Fork lencx/ChatGPT** | 节省 2-3 周 |
| AI 接入方式 | API vs WebView | **内嵌 WebView** | 复用订阅、零额外成本 |
| 调研策略 | 单一 vs 并行 | **Phase1 单一，Phase2 并行** | MVP 先验证核心流程 |
| WebView 可见性 | 隐藏 vs 可视 vs 混合 | **混合式** | 默认隐藏，可展开查看 |
| UI 风格 | 自定义 vs 参考 | **类微软 Todo** | 简洁易用 |

---

*文档生成时间: 2026-01-11*
